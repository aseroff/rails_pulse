#!/bin/bash

# Setup git hooks for Rails Pulse development
# This script copies shared hooks from scripts/git-hooks to .git/hooks

HOOKS_DIR="scripts/git-hooks"
GIT_HOOKS_DIR=".git/hooks"

if [ ! -d "$HOOKS_DIR" ]; then
    echo "❌ Error: $HOOKS_DIR directory not found"
    exit 1
fi

if [ ! -d "$GIT_HOOKS_DIR" ]; then
    echo "❌ Error: $GIT_HOOKS_DIR directory not found. Are you in a git repository?"
    exit 1
fi

echo "Setting up git hooks..."

# Copy all hooks from scripts/git-hooks to .git/hooks
for hook in "$HOOKS_DIR"/*; do
    if [ -f "$hook" ]; then
        hook_name=$(basename "$hook")
        echo "Installing $hook_name hook..."
        cp "$hook" "$GIT_HOOKS_DIR/$hook_name"
        chmod +x "$GIT_HOOKS_DIR/$hook_name"
    fi
done

echo "✅ Git hooks installed successfully!"
echo ""
echo "Installed hooks:"
ls -la "$GIT_HOOKS_DIR" | grep -v ".sample" | grep -E "^-.*x.*"
echo ""
echo "The pre-commit hook will now run RuboCop before each commit."