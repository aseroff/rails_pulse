<div style="font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px;">
  <h1>Rails Pulse Test Dashboard</h1>
  <p>This page executes various database queries to populate Rails Pulse with realistic monitoring data.</p>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">

    <section style="border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
      <h2>Recent Users (<%= @recent_users.count %>)</h2>
      <% if @recent_users.any? %>
        <ul>
          <% @recent_users.each do |user| %>
            <li>
              <strong><%= user.name %></strong> (<%= user.email %>)
              - <%= pluralize(user.posts.count, 'post') %>
              - <%= pluralize(user.comments.count, 'comment') %>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p>No recent users found.</p>
      <% end %>
    </section>

    <section style="border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
      <h2>Post Statistics by Author</h2>
      <% if @post_stats.any? %>
        <ul>
          <% @post_stats.each do |author, count| %>
            <li><%= author %>: <%= pluralize(count, 'post') %></li>
          <% end %>
        </ul>
      <% else %>
        <p>No post statistics available.</p>
      <% end %>
    </section>

    <section style="border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
      <h2>Search Results (Sample Posts)</h2>
      <% if @search_results.any? %>
        <ul>
          <% @search_results.each do |post| %>
            <li>
              <strong><%= post.title %></strong> by <%= post.user&.name || 'Unknown' %>
              (<%= pluralize(post.comments.count, 'comment') %>)
            </li>
          <% end %>
        </ul>
      <% else %>
        <p>No sample posts found.</p>
      <% end %>
    </section>

    <section style="border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
      <h2>Popular Posts (2+ Comments)</h2>
      <% if @popular_posts.any? %>
        <ul>
          <% @popular_posts.each do |post| %>
            <li>
              <strong><%= post.title %></strong> by <%= post.user&.name || 'Unknown' %>
              (<%= pluralize(post.comments.count, 'comment') %>)
            </li>
          <% end %>
        </ul>
      <% else %>
        <p>No popular posts found.</p>
      <% end %>
    </section>

  </div>

  <section style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-top: 20px;">
    <h2>Recent Posts (Paginated)</h2>
    <% if @paginated_posts.any? %>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
        <% @paginated_posts.each do |post| %>
          <div style="border: 1px solid #eee; padding: 15px; border-radius: 4px;">
            <h4><%= post.title %></h4>
            <p style="color: #666; font-size: 14px;">
              By <%= post.user&.name || 'Unknown' %> • <%= time_ago_in_words(post.created_at) %> ago
            </p>
            <p><%= truncate(post.content, length: 100) %></p>
          </div>
        <% end %>
      </div>
    <% else %>
      <p>No posts found.</p>
    <% end %>
  </section>

  <% if @featured_user %>
    <section style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-top: 20px;">
      <h2>Featured User</h2>
      <p>
        <strong><%= @featured_user.name %></strong> (<%= @featured_user.email %>)
        has written <%= pluralize(@user_post_count, 'post') %>.
      </p>
    </section>
  <% end %>

  <section style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-top: 20px;">
    <h2>Activity Summary</h2>
    <ul>
      <li>Recent activity detected: <%= @has_recent_activity ? 'Yes' : 'No' %></li>
      <li>Post authors loaded: <%= @post_authors.join(', ') %></li>
    </ul>
  </section>

  <div style="margin-top: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
    <h3>About This Page</h3>
    <p>
      This page executes multiple database queries including:
      <strong>joins, aggregations, subqueries, LIKE searches, existence checks, and N+1 patterns</strong>.
      Each request generates realistic data for Rails Pulse monitoring.
    </p>
    <p>
      <a href="/rails_pulse" style="color: #007bff; text-decoration: none;">→ View Rails Pulse Dashboard</a>
    </p>
  </div>
</div>
