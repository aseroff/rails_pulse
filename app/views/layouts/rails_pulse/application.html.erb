<!DOCTYPE html>
<html data-color-scheme="light">
  <head>
    <title><%= content_for(:title) || "Rails Pulse" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag "css-zero/reset", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "css-zero/variables", "data-turbo-track": "reload" %>
    <% Dir.glob(RailsPulse::Engine.root.join("app/assets/stylesheets/rails_pulse/*.css")).each do |file| %>
      <%= stylesheet_link_tag "rails_pulse/#{File.basename(file, '.css')}", media: "all" %>
    <% end %>
    <%= stylesheet_link_tag "css-zero/utilities", "data-turbo-track": "reload" %>

    <%= javascript_importmap_tags %>

    <script type="module">
      import "rails_pulse/application";
    </script>
  </head>

  <body class="header-layout">
    <header id="header">
      <div class="flex justify-between container">
        <div class="hide@md" data-controller="rails-pulse--dialog">
          <button type="button" class="btn btn--icon" data-action="rails-pulse--dialog#showModal">
            <%= lucide_icon 'menu', width: '20' %>
            <span class="sr-only">Open menu</span>
          </button>

        <dialog class="sheet sheet--left" style="--sheet-size: 288px;" data-rails-pulse--dialog-target="menu" data-action="click->rails-pulse--dialog#closeOnClickOutside">
          <div class="sheet__content p-2">
            <div class="sidebar-menu">
              <a class="btn sidebar-menu__button" href="#">
                <div class="flex flex-col text-start leading-tight overflow-hidden">
                  <span class="overflow-ellipsis font-semibold">Rails Pulse</span>
                  <span class="overflow-ellipsis text-xs">Open Source</span>
                </div>
              </a>
              <div class="sidebar-menu__content">
                <div class="sidebar-menu__group">
                  <nav class="sidebar-menu__items">
                    <%= render 'layouts/rails_pulse/menu_items' %>
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </dialog>
      </div>

      <div class="flex items-center gap">
        <a class="flex items-center gap mie-2" href="#">
          <span class="font-bold">Rails Pulse</span>
        </a>
        <nav class="flex items-center gap text-sm text-subtle show@md" style="--column-gap: 1rem">
          <%= render 'layouts/rails_pulse/menu_items' %>
        </nav>
      </div>

      <div class="flex items-center" data-controller="rails-pulse--color-scheme">
        <%= link_to '#', "aria-label": "Toggle color scheme", role: "button", data: { action: "rails-pulse--color-scheme#toggle" } do %>
          <%= lucide_icon 'sun', width: '48' %>
        <% end %>
      </div>
    </header>

    <main id="main">
      <div class="container flex flex-col gap">
        <%= yield %>
      </div>
    </main>

    <script>
        window.addEventListener('resize', function() {
          Object.keys(window.RailsCharts.charts).forEach(function(chartID) {
            window.RailsCharts.charts[chartID].resize();
          });
        });
    </script>
  </body>
</html>
