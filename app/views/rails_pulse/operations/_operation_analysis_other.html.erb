<dt>Operation Performance</dt>
<dd>
  <% case operation.operation_type %>
  <% when "cache_read", "cache_write" %>
    <% if operation.operation_type == "cache_read" %>
      <% if operation.duration > 10 %>
        Slow cache read (>10ms)
      <% else %>
        Fast cache read
      <% end %>
    <% else %>
      <% if operation.duration > 50 %>
        Slow cache write (>50ms)
      <% else %>
        Fast cache write
      <% end %>
    <% end %>
  <% when "http" %>
    <% if operation.duration > 1000 %>
      Very slow request (>1s)
    <% elsif operation.duration > 500 %>
      Slow request (>500ms)
    <% else %>
      Fast request
    <% end %>
  <% when "job" %>
    <% if operation.duration > 5000 %>
      Long-running job (>5s)
    <% elsif operation.duration > 1000 %>
      Moderate job (>1s)
    <% else %>
      Quick job
    <% end %>
  <% when "mailer" %>
    <% if operation.duration > 2000 %>
      Slow email delivery (>2s)
    <% elsif operation.duration > 500 %>
      Moderate delivery (>500ms)
    <% else %>
      Fast delivery
    <% end %>
  <% when "storage" %>
    <% if operation.duration > 1000 %>
      Slow storage operation (>1s)
    <% elsif operation.duration > 500 %>
      Moderate storage (>500ms)
    <% else %>
      Fast storage
    <% end %>
  <% else %>
    Duration: <%= operation.duration.round(2) %>ms
  <% end %>
</dd>

<% if operation.operation_type == "http" && operation.label&.match?(/https?:\/\/([^\/\s]+)/) %>
  <% domain = operation.label.match(/https?:\/\/([^\/\s]+)/)&.captures&.first %>
  <dt>External Service</dt>
  <dd><%= html_escape(domain) %></dd>
<% end %>

<% if operation.label.present? && operation.label != operation.operation_type %>
  <dt>Details</dt>
  <dd><%= html_escape(truncate(operation.label, length: 100)) %></dd>
<% end %>

<% if operation.codebase_location.present? %>
  <dt>Source</dt>
  <dd><code><%= html_escape(operation.codebase_location.split('/').last(3).join('/')) %></code></dd>
<% end %>
